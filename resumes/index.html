<!DOCTYPE html>
<html lang="en-AU">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Aaron Munro - Resume Archive">
    <title>Resume Archive - Aaron Munro</title>
    <link rel="stylesheet" href="../css/style.css">
    <style>
        .archive-container {
            max-width: 1800px;
            margin: 40px auto;
            padding: 20px;
        }

        .archive-title {
            text-align: center;
            color: #00205B;
            margin-bottom: 30px;
            font-size: 2.5rem;
        }

        .split-container {
            display: flex;
            gap: 30px;
            align-items: flex-start;
        }

        .left-column {
            flex: 1;
            min-width: 0;
        }

        .right-column {
            flex: 1;
            min-width: 0;
        }

        .section-title {
            text-align: center;
            color: #00205B;
            margin-bottom: 20px;
            font-size: 1.8rem;
            font-weight: 700;
        }

        .archive-cards {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .job-cards {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .archive-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            padding: 20px;
            transition: box-shadow 0.3s, transform 0.2s;
        }

        .archive-card:hover {
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #00205B;
        }

        .card-date {
            font-weight: 700;
            color: #00205B;
            font-size: 1.1rem;
        }

        .application-info {
            flex: 1;
            margin-left: 30px;
        }

        .company-name {
            font-weight: 700;
            color: #00205B;
            font-size: 1.2rem;
            margin-bottom: 5px;
        }

        .job-title {
            color: #333;
            font-size: 1rem;
            margin-bottom: 8px;
        }

        .job-link {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            color: #00B8E8;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .job-link:hover {
            text-decoration: underline;
        }

        .no-application-data {
            color: #999;
            font-style: italic;
            font-size: 0.95rem;
        }

        .files-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .file-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .file-label {
            font-size: 0.85rem;
            color: #666;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .link-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .file-link {
            color: #00B8E8;
            text-decoration: none;
            font-weight: 500;
            font-size: 0.95rem;
            word-break: break-word;
        }

        .file-link:hover {
            text-decoration: underline;
            color: #0096c7;
        }

        .copy-icon {
            cursor: pointer;
            font-size: 1.1rem;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s;
            user-select: none;
            flex-shrink: 0;
        }

        .copy-icon:hover {
            background: #e0e0e0;
        }

        .copy-icon:active {
            transform: scale(0.95);
        }

        .not-generated {
            color: #999;
            font-style: italic;
            font-size: 0.9rem;
        }

        .copied-tooltip {
            position: relative;
        }

        .copied-tooltip::after {
            content: 'Copied!';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #222;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.75rem;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .copied-tooltip.show::after {
            opacity: 1;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 1.1rem;
        }

        @media print {
            .copy-icon {
                display: none;
            }
        }

        .job-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            padding: 20px;
            transition: box-shadow 0.3s, transform 0.2s;
        }

        .job-card:hover {
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }

        .job-card-date {
            font-weight: 700;
            color: #00205B;
            font-size: 1.1rem;
            margin-bottom: 10px;
        }

        .job-card-link {
            display: inline-block;
            color: #00B8E8;
            text-decoration: none;
            font-weight: 600;
            font-size: 1rem;
            margin-top: 10px;
        }

        .job-card-link:hover {
            text-decoration: underline;
        }

        .job-card iframe {
            width: 100%;
            height: 400px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-top: 10px;
        }

        @media (max-width: 1200px) {
            .split-container {
                flex-direction: column;
            }

            .left-column,
            .right-column {
                width: 100%;
            }
        }

        @media (max-width: 768px) {
            .archive-container {
                padding: 10px;
            }

            .archive-title {
                font-size: 1.8rem;
            }

            .section-title {
                font-size: 1.4rem;
            }

            .card-header {
                flex-direction: column;
                gap: 10px;
            }

            .application-info {
                margin-left: 0;
            }

            .files-grid {
                grid-template-columns: 1fr;
            }

            .company-name {
                font-size: 1.1rem;
            }

            .job-title {
                font-size: 0.95rem;
            }
        }

        /* Editor Section Styles */
        .editor-section {
            max-width: 1800px;
            margin: 60px auto 40px auto;
            padding: 20px;
            background: #f5f5f5;
            border-radius: 12px;
        }

        .editor-title {
            text-align: center;
            color: #00205B;
            margin-bottom: 30px;
            font-size: 2rem;
        }

        .auth-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .auth-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .auth-status-text {
            font-weight: 600;
            color: #333;
        }

        .status-indicator {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .status-authenticated {
            background: #4CAF50;
            color: white;
        }

        .status-not-authenticated {
            background: #ff9800;
            color: white;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #00B8E8;
            color: white;
        }

        .btn-primary:hover {
            background: #0096c7;
        }

        .btn-success {
            background: #4CAF50;
            color: white;
        }

        .btn-success:hover {
            background: #45a049;
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn-danger:hover {
            background: #da190b;
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .editor-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }

        .editor-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .editor-card-title {
            color: #00205B;
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 15px;
            border-bottom: 2px solid #00B8E8;
            padding-bottom: 10px;
        }

        .editor-textarea {
            width: 100%;
            min-height: 400px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 0.95rem;
            resize: vertical;
            transition: border-color 0.3s;
        }

        .editor-textarea:focus {
            outline: none;
            border-color: #00B8E8;
        }

        .editor-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
        }

        .save-status {
            font-size: 0.9rem;
            color: #666;
            font-style: italic;
        }

        .save-status.success {
            color: #4CAF50;
        }

        .save-status.error {
            color: #f44336;
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #00B8E8;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }

        .info-box p {
            margin: 5px 0;
            font-size: 0.95rem;
            color: #333;
        }

        .info-box strong {
            color: #00205B;
        }

        @media (max-width: 1200px) {
            .editor-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="archive-container">
        <h1 class="archive-title">Resume & Job Search Archive</h1>
        <div class="split-container">
            <div class="left-column">
                <h2 class="section-title">Resumes & Cover Letters</h2>
                <div id="archive-cards" class="archive-cards">
                    <!-- Resume cards will be dynamically generated -->
                    <div class="loading">Loading...</div>
                </div>
            </div>
            <div class="right-column">
                <h2 class="section-title">Job Listings</h2>
                <div id="job-cards" class="job-cards">
                    <!-- Job cards will be dynamically generated -->
                    <div class="loading">Loading...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Editor Section -->
    <div class="editor-section">
        <h2 class="editor-title">Job Search Configuration Editor</h2>
        
        <div class="info-box">
            <p><strong>About this section:</strong> Edit your job search configuration files directly in the browser.</p>
            <p><strong>Security:</strong> Changes are saved securely to GitHub using OAuth authentication. Only authorized users can save changes.</p>
            <p><strong>Files:</strong> SearchSites.md contains job search platforms, JobRoles.md contains target job titles.</p>
        </div>

        <div class="auth-section">
            <div class="auth-status">
                <span class="auth-status-text">Authentication Status:</span>
                <span id="auth-status" class="status-indicator status-not-authenticated">Not Authenticated</span>
            </div>
            <div>
                <button id="auth-button" class="btn btn-primary" onclick="handleAuth()">Authenticate with GitHub</button>
                <button id="logout-button" class="btn btn-danger" onclick="handleLogout()" style="display: none;">Logout</button>
            </div>
            <div id="user-info" style="margin-top: 15px; color: #666; font-size: 0.95rem;"></div>
        </div>

        <div class="editor-container">
            <div class="editor-card">
                <h3 class="editor-card-title">SearchSites.md</h3>
                <textarea id="searchsites-editor" class="editor-textarea" placeholder="Loading..."></textarea>
                <div class="editor-actions">
                    <span id="searchsites-status" class="save-status"></span>
                    <button class="btn btn-success" onclick="saveFile('SearchSites')" id="save-searchsites" disabled>Save to GitHub</button>
                </div>
            </div>

            <div class="editor-card">
                <h3 class="editor-card-title">JobRoles.md</h3>
                <textarea id="jobroles-editor" class="editor-textarea" placeholder="Loading..."></textarea>
                <div class="editor-actions">
                    <span id="jobroles-status" class="save-status"></span>
                    <button class="btn btn-success" onclick="saveFile('JobRoles')" id="save-jobroles" disabled>Save to GitHub</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Load folder data from JSON file
        async function loadFolderData() {
            try {
                const response = await fetch('../folder-data.json');
                if (!response.ok) {
                    throw new Error('Failed to load folder data');
                }
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Error loading folder data:', error);
                return { resumes: [], jobs: [] };
            }
        }

        // Format date from YYMMDDhhmm format
        function formatDate(folderName) {
            if (folderName.length !== 10) return folderName;

            const year = folderName.substring(0, 2);
            const month = folderName.substring(2, 4);
            const day = folderName.substring(4, 6);
            const hour = folderName.substring(6, 8);
            const minute = folderName.substring(8, 10);

            // Convert YY to full year (assume 20xx for years 00-29, 19xx for 30-99)
            let fullYear;
            const yearInt = parseInt(year);
            if (yearInt >= 0 && yearInt <= 29) {
                fullYear = `20${year}`;
            } else {
                fullYear = `19${year}`;
            }

            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 
                          'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const monthInt = parseInt(month);
            
            // Validate month
            if (monthInt < 1 || monthInt > 12) {
                return folderName; // Return raw if invalid
            }
            
            const monthName = months[monthInt - 1];

            return `${day} ${monthName} ${fullYear} ${hour}:${minute}`;
        }

        // Get absolute URL for a file
        function getAbsoluteUrl(folderName, fileName) {
            const baseUrl = window.location.origin + window.location.pathname.replace(/\/[^\/]*$/, '');
            return `${baseUrl}/${folderName}/${fileName}`;
        }

        // Get absolute URL for job listing
        function getJobAbsoluteUrl(folderName, fileName) {
            const baseUrl = window.location.origin + window.location.pathname.replace(/resumes\/[^\/]*$/, '');
            return `${baseUrl}jobs/${folderName}/${fileName}`;
        }

        // Copy URL to clipboard
        function copyToClipboard(url, iconElement) {
            navigator.clipboard.writeText(url).then(() => {
                // Show copied tooltip
                iconElement.classList.add('show');
                setTimeout(() => {
                    iconElement.classList.remove('show');
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy:', err);
                alert('Failed to copy URL to clipboard');
            });
        }

        // Create a file link element with copy icon
        function createFileLink(folderName, fileName, label) {
            const fileItem = document.createElement('div');
            fileItem.className = 'file-item';

            const labelElement = document.createElement('div');
            labelElement.className = 'file-label';
            labelElement.textContent = label;
            fileItem.appendChild(labelElement);

            if (fileName) {
                const container = document.createElement('div');
                container.className = 'link-container';

                const link = document.createElement('a');
                link.href = `${folderName}/${fileName}`;
                link.className = 'file-link';
                link.textContent = fileName;
                link.target = '_blank';

                const copyIcon = document.createElement('span');
                copyIcon.className = 'copy-icon copied-tooltip';
                copyIcon.textContent = 'ðŸ“‹';
                copyIcon.title = 'Copy URL';
                copyIcon.onclick = (e) => {
                    e.preventDefault();
                    const url = getAbsoluteUrl(folderName, fileName);
                    copyToClipboard(url, copyIcon);
                };

                container.appendChild(link);
                container.appendChild(copyIcon);
                fileItem.appendChild(container);
            } else {
                const span = document.createElement('span');
                span.className = 'not-generated';
                span.textContent = 'Not Generated';
                fileItem.appendChild(span);
            }

            return fileItem;
        }

        // Generate job cards
        async function generateJobCards(jobsData) {
            const jobCardsContainer = document.getElementById('job-cards');
            jobCardsContainer.innerHTML = '';

            if (jobsData.length === 0) {
                jobCardsContainer.innerHTML = '<div class="loading">No job listings found</div>';
                return;
            }

            jobsData.forEach(jobData => {
                const folder = jobData.name;
                const files = jobData.files;

                const card = document.createElement('div');
                card.className = 'job-card';

                // Date
                const dateDiv = document.createElement('div');
                dateDiv.className = 'job-card-date';
                dateDiv.textContent = formatDate(folder);
                card.appendChild(dateDiv);

                // Link to job listing
                if (files.html) {
                    const link = document.createElement('a');
                    link.href = `../jobs/${folder}/${files.html}`;
                    link.className = 'job-card-link';
                    link.textContent = 'View Job Listing Details â†’';
                    link.target = '_blank';
                    card.appendChild(link);

                    // Embed iframe to show preview
                    const iframe = document.createElement('iframe');
                    iframe.src = `../jobs/${folder}/${files.html}`;
                    iframe.title = `Job listing from ${formatDate(folder)}`;
                    card.appendChild(iframe);
                }

                jobCardsContainer.appendChild(card);
            });
        }

        // Generate resume cards
        async function generateCards() {
            const cardsContainer = document.getElementById('archive-cards');
            cardsContainer.innerHTML = '<div class="loading">Loading...</div>';

            try {
                // Load folder data from JSON
                const data = await loadFolderData();
                const folders = data.resumes || [];
                const jobs = data.jobs || [];
                
                // Clear loading message
                cardsContainer.innerHTML = '';
                
                // Generate job cards
                generateJobCards(jobs);
                
                // Process each resume folder
                folders.forEach(folderData => {
                    const folder = folderData.name;
                    const files = folderData.files;
                    
                    const card = document.createElement('div');
                    card.className = 'archive-card';

                    // Card header with date and application info
                    const header = document.createElement('div');
                    header.className = 'card-header';

                    const dateDiv = document.createElement('div');
                    dateDiv.className = 'card-date';
                    dateDiv.textContent = formatDate(folder);
                    header.appendChild(dateDiv);

                    // Application information
                    const appInfo = document.createElement('div');
                    appInfo.className = 'application-info';

                    if (files.applicationData) {
                        const companyDiv = document.createElement('div');
                        companyDiv.className = 'company-name';
                        companyDiv.textContent = files.applicationData.Company || 'N/A';
                        appInfo.appendChild(companyDiv);

                        const jobTitleDiv = document.createElement('div');
                        jobTitleDiv.className = 'job-title';
                        jobTitleDiv.textContent = files.applicationData['Job Title'] || 'N/A';
                        appInfo.appendChild(jobTitleDiv);

                        if (files.applicationData['Job Listing URL']) {
                            const jobLink = document.createElement('a');
                            jobLink.href = files.applicationData['Job Listing URL'];
                            jobLink.className = 'job-link';
                            jobLink.target = '_blank';
                            jobLink.rel = 'noopener noreferrer';
                            jobLink.innerHTML = 'ðŸ”— View Job Listing';
                            appInfo.appendChild(jobLink);
                        }
                    } else {
                        const noData = document.createElement('div');
                        noData.className = 'no-application-data';
                        noData.textContent = 'No application details available';
                        appInfo.appendChild(noData);
                    }

                    header.appendChild(appInfo);
                    card.appendChild(header);

                    // Files grid
                    const filesGrid = document.createElement('div');
                    filesGrid.className = 'files-grid';

                    // HTML Resume
                    filesGrid.appendChild(createFileLink(folder, files.html, 'HTML Resume'));

                    // Docx Resume
                    filesGrid.appendChild(createFileLink(folder, files.resume, 'Docx Resume'));

                    // Cover Letter
                    filesGrid.appendChild(createFileLink(folder, files.coverLetter, 'Cover Letter'));

                    card.appendChild(filesGrid);
                    cardsContainer.appendChild(card);
                });
                
                if (folders.length === 0) {
                    cardsContainer.innerHTML = '<div class="loading">No date folders found</div>';
                }
            } catch (error) {
                console.error('Error generating cards:', error);
                cardsContainer.innerHTML = '<div class="loading" style="color: red;">Error loading data</div>';
            }
        }

        // Initialize cards on page load
        document.addEventListener('DOMContentLoaded', generateCards);

        // ============================================
        // GitHub OAuth and File Editor Functionality
        // ============================================

        const GITHUB_CLIENT_ID = 'Ov23liDEPGpyLygXjFwY'; // This will need to be replaced with actual OAuth App Client ID
        const GITHUB_REPO_OWNER = 'azzamunza';
        const GITHUB_REPO_NAME = 'resume';
        const GITHUB_BRANCH = 'main';
        
        let accessToken = null;
        let userInfo = null;

        // Load files on page load
        document.addEventListener('DOMContentLoaded', async () => {
            // Check if returning from OAuth
            checkOAuthCallback();
            
            // Check for stored token
            checkStoredAuth();
            
            // Load file contents
            await loadFileContents();
        });

        // Check if this is an OAuth callback
        function checkOAuthCallback() {
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');
            
            if (code) {
                // Clear URL parameters
                window.history.replaceState({}, document.title, window.location.pathname);
                
                // Exchange code for token (in production, this should be done server-side)
                // For now, we'll use GitHub's device flow or manual token
                showMessage('OAuth callback received. Please configure token exchange.', 'info');
            }
        }

        // Check for stored authentication
        function checkStoredAuth() {
            accessToken = localStorage.getItem('github_access_token');
            userInfo = JSON.parse(localStorage.getItem('github_user_info') || 'null');
            
            if (accessToken && userInfo) {
                updateAuthUI(true);
            }
        }

        // Handle authentication
        function handleAuth() {
            // For security, we'll use GitHub's Personal Access Token flow
            // User needs to create a token with repo scope at: https://github.com/settings/tokens
            
            const token = prompt(
                'GitHub Personal Access Token Required\n\n' +
                'To save changes to GitHub, you need a Personal Access Token with "repo" scope.\n\n' +
                'Steps to create a token:\n' +
                '1. Go to: https://github.com/settings/tokens\n' +
                '2. Click "Generate new token (classic)"\n' +
                '3. Select "repo" scope\n' +
                '4. Generate token and copy it\n\n' +
                'Paste your token below:'
            );
            
            if (token && token.trim()) {
                accessToken = token.trim();
                
                // Verify token by getting user info
                fetch('https://api.github.com/user', {
                    headers: {
                        'Authorization': `Bearer ${accessToken}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Invalid token');
                    }
                    return response.json();
                })
                .then(user => {
                    // Check if user has access to the repo
                    return fetch(`https://api.github.com/repos/${GITHUB_REPO_OWNER}/${GITHUB_REPO_NAME}`, {
                        headers: {
                            'Authorization': `Bearer ${accessToken}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('No access to repository');
                        }
                        return user;
                    });
                })
                .then(user => {
                    userInfo = {
                        login: user.login,
                        name: user.name,
                        id: user.id
                    };
                    
                    // Store in localStorage
                    localStorage.setItem('github_access_token', accessToken);
                    localStorage.setItem('github_user_info', JSON.stringify(userInfo));
                    
                    updateAuthUI(true);
                    showMessage(`Successfully authenticated as ${user.login}`, 'success');
                })
                .catch(error => {
                    console.error('Authentication error:', error);
                    alert('Authentication failed. Please check your token and try again.\n\nError: ' + error.message);
                    accessToken = null;
                    userInfo = null;
                });
            }
        }

        // Handle logout
        function handleLogout() {
            if (confirm('Are you sure you want to logout?')) {
                accessToken = null;
                userInfo = null;
                localStorage.removeItem('github_access_token');
                localStorage.removeItem('github_user_info');
                updateAuthUI(false);
                showMessage('Logged out successfully', 'info');
            }
        }

        // Update authentication UI
        function updateAuthUI(authenticated) {
            const authStatus = document.getElementById('auth-status');
            const authButton = document.getElementById('auth-button');
            const logoutButton = document.getElementById('logout-button');
            const userInfoDiv = document.getElementById('user-info');
            const saveButtons = document.querySelectorAll('[id^="save-"]');
            
            if (authenticated && userInfo) {
                authStatus.textContent = 'Authenticated';
                authStatus.className = 'status-indicator status-authenticated';
                authButton.style.display = 'none';
                logoutButton.style.display = 'inline-block';
                userInfoDiv.innerHTML = `Logged in as: <strong>${userInfo.login}</strong>${userInfo.name ? ` (${userInfo.name})` : ''}`;
                
                // Enable save buttons
                saveButtons.forEach(btn => btn.disabled = false);
            } else {
                authStatus.textContent = 'Not Authenticated';
                authStatus.className = 'status-indicator status-not-authenticated';
                authButton.style.display = 'inline-block';
                logoutButton.style.display = 'none';
                userInfoDiv.innerHTML = '';
                
                // Disable save buttons
                saveButtons.forEach(btn => btn.disabled = true);
            }
        }

        // Load file contents from GitHub
        async function loadFileContents() {
            try {
                // Load SearchSites.md
                const searchSitesResponse = await fetch(`https://raw.githubusercontent.com/${GITHUB_REPO_OWNER}/${GITHUB_REPO_NAME}/${GITHUB_BRANCH}/data/SearchSites.md`);
                if (searchSitesResponse.ok) {
                    const searchSitesContent = await searchSitesResponse.text();
                    document.getElementById('searchsites-editor').value = searchSitesContent;
                } else {
                    document.getElementById('searchsites-editor').value = '# Error loading file\n\nCould not load SearchSites.md';
                }
                
                // Load JobRoles.md
                const jobRolesResponse = await fetch(`https://raw.githubusercontent.com/${GITHUB_REPO_OWNER}/${GITHUB_REPO_NAME}/${GITHUB_BRANCH}/data/JobRoles.md`);
                if (jobRolesResponse.ok) {
                    const jobRolesContent = await jobRolesResponse.text();
                    document.getElementById('jobroles-editor').value = jobRolesContent;
                } else {
                    document.getElementById('jobroles-editor').value = '# Error loading file\n\nCould not load JobRoles.md';
                }
            } catch (error) {
                console.error('Error loading files:', error);
                showMessage('Error loading files from GitHub', 'error');
            }
        }

        // Save file to GitHub
        async function saveFile(fileType) {
            if (!accessToken) {
                alert('Please authenticate with GitHub first');
                return;
            }
            
            const fileName = fileType === 'SearchSites' ? 'SearchSites.md' : 'JobRoles.md';
            const filePath = `data/${fileName}`;
            const editorId = fileType === 'SearchSites' ? 'searchsites-editor' : 'jobroles-editor';
            const statusId = fileType === 'SearchSites' ? 'searchsites-status' : 'jobroles-status';
            const saveButtonId = fileType === 'SearchSites' ? 'save-searchsites' : 'save-jobroles';
            
            const content = document.getElementById(editorId).value;
            const statusElement = document.getElementById(statusId);
            const saveButton = document.getElementById(saveButtonId);
            
            // Disable save button during save
            saveButton.disabled = true;
            statusElement.textContent = 'Saving...';
            statusElement.className = 'save-status';
            
            try {
                // Get the current file SHA (required for updating)
                const fileInfoResponse = await fetch(
                    `https://api.github.com/repos/${GITHUB_REPO_OWNER}/${GITHUB_REPO_NAME}/contents/${filePath}?ref=${GITHUB_BRANCH}`,
                    {
                        headers: {
                            'Authorization': `Bearer ${accessToken}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    }
                );
                
                if (!fileInfoResponse.ok) {
                    throw new Error('Could not get file information');
                }
                
                const fileInfo = await fileInfoResponse.json();
                const sha = fileInfo.sha;
                
                // Update the file
                const updateResponse = await fetch(
                    `https://api.github.com/repos/${GITHUB_REPO_OWNER}/${GITHUB_REPO_NAME}/contents/${filePath}`,
                    {
                        method: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${accessToken}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            message: `Update ${fileName} via web editor`,
                            content: btoa(unescape(encodeURIComponent(content))), // Base64 encode with UTF-8 support
                            sha: sha,
                            branch: GITHUB_BRANCH
                        })
                    }
                );
                
                if (!updateResponse.ok) {
                    const errorData = await updateResponse.json();
                    throw new Error(errorData.message || 'Failed to update file');
                }
                
                statusElement.textContent = 'Saved successfully! âœ“';
                statusElement.className = 'save-status success';
                
                // Clear status after 3 seconds
                setTimeout(() => {
                    statusElement.textContent = '';
                    statusElement.className = 'save-status';
                }, 3000);
                
            } catch (error) {
                console.error('Save error:', error);
                statusElement.textContent = 'Error saving: ' + error.message;
                statusElement.className = 'save-status error';
            } finally {
                // Re-enable save button
                saveButton.disabled = false;
            }
        }

        // Show message helper
        function showMessage(message, type) {
            // Simple console log for now
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
    </script>
</body>
</html>
