<!DOCTYPE html>
<html lang="en-AU">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Aaron Munro - Resume Archive">
    <title>Resume Archive - Aaron Munro</title>
    <link rel="stylesheet" href="../css/style.css">
    <style>
        .archive-container {
            max-width: 1800px;
            margin: 40px auto;
            padding: 20px;
        }

        .archive-title {
            text-align: center;
            color: #00205B;
            margin-bottom: 30px;
            font-size: 2.5rem;
        }

        .split-container {
            display: flex;
            gap: 30px;
            align-items: flex-start;
        }

        .left-column {
            flex: 1;
            min-width: 0;
        }

        .right-column {
            flex: 1;
            min-width: 0;
        }

        .section-title {
            text-align: center;
            color: #00205B;
            margin-bottom: 20px;
            font-size: 1.8rem;
            font-weight: 700;
        }

        .archive-cards {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .job-cards {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .archive-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            padding: 20px;
            transition: box-shadow 0.3s, transform 0.2s;
        }

        .archive-card:hover {
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #00205B;
        }

        .card-date {
            font-weight: 700;
            color: #00205B;
            font-size: 1.1rem;
        }

        .application-info {
            flex: 1;
            margin-left: 30px;
        }

        .company-name {
            font-weight: 700;
            color: #00205B;
            font-size: 1.2rem;
            margin-bottom: 5px;
        }

        .job-title {
            color: #333;
            font-size: 1rem;
            margin-bottom: 8px;
        }

        .job-link {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            color: #00B8E8;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .job-link:hover {
            text-decoration: underline;
        }

        .no-application-data {
            color: #999;
            font-style: italic;
            font-size: 0.95rem;
        }

        .files-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .file-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .file-label {
            font-size: 0.85rem;
            color: #666;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .link-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .file-link {
            color: #00B8E8;
            text-decoration: none;
            font-weight: 500;
            font-size: 0.95rem;
            word-break: break-word;
        }

        .file-link:hover {
            text-decoration: underline;
            color: #0096c7;
        }

        .copy-icon {
            cursor: pointer;
            font-size: 1.1rem;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s;
            user-select: none;
            flex-shrink: 0;
        }

        .copy-icon:hover {
            background: #e0e0e0;
        }

        .copy-icon:active {
            transform: scale(0.95);
        }

        .not-generated {
            color: #999;
            font-style: italic;
            font-size: 0.9rem;
        }

        .copied-tooltip {
            position: relative;
        }

        .copied-tooltip::after {
            content: 'Copied!';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #222;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.75rem;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .copied-tooltip.show::after {
            opacity: 1;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 1.1rem;
        }

        @media print {
            .copy-icon {
                display: none;
            }
        }

        .job-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            padding: 20px;
            transition: box-shadow 0.3s, transform 0.2s;
        }

        .job-card:hover {
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }

        .job-card-date {
            font-weight: 700;
            color: #00205B;
            font-size: 1.1rem;
            margin-bottom: 10px;
        }

        .job-card-link {
            display: inline-block;
            color: #00B8E8;
            text-decoration: none;
            font-weight: 600;
            font-size: 1rem;
            margin-top: 10px;
        }

        .job-card-link:hover {
            text-decoration: underline;
        }

        .job-card iframe {
            width: 100%;
            height: 400px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-top: 10px;
        }

        @media (max-width: 1200px) {
            .split-container {
                flex-direction: column;
            }

            .left-column,
            .right-column {
                width: 100%;
            }
        }

        @media (max-width: 768px) {
            .archive-container {
                padding: 10px;
            }

            .archive-title {
                font-size: 1.8rem;
            }

            .section-title {
                font-size: 1.4rem;
            }

            .card-header {
                flex-direction: column;
                gap: 10px;
            }

            .application-info {
                margin-left: 0;
            }

            .files-grid {
                grid-template-columns: 1fr;
            }

            .company-name {
                font-size: 1.1rem;
            }

            .job-title {
                font-size: 0.95rem;
            }
        }
    </style>
</head>
<body>
    <div class="archive-container">
        <h1 class="archive-title">Resume & Job Search Archive</h1>
        <div class="split-container">
            <div class="left-column">
                <h2 class="section-title">Resumes & Cover Letters</h2>
                <div id="archive-cards" class="archive-cards">
                    <!-- Resume cards will be dynamically generated -->
                    <div class="loading">Loading...</div>
                </div>
            </div>
            <div class="right-column">
                <h2 class="section-title">Job Listings</h2>
                <div id="job-cards" class="job-cards">
                    <!-- Job cards will be dynamically generated -->
                    <div class="loading">Loading...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Load folder data from JSON file
        async function loadFolderData() {
            try {
                const response = await fetch('../folder-data.json');
                if (!response.ok) {
                    throw new Error('Failed to load folder data');
                }
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Error loading folder data:', error);
                return { resumes: [], jobs: [] };
            }
        }

        // Format date from YYMMDDhhmm format
        function formatDate(folderName) {
            if (folderName.length !== 10) return folderName;

            const year = folderName.substring(0, 2);
            const month = folderName.substring(2, 4);
            const day = folderName.substring(4, 6);
            const hour = folderName.substring(6, 8);
            const minute = folderName.substring(8, 10);

            // Convert YY to full year (assume 20xx for years 00-29, 19xx for 30-99)
            let fullYear;
            const yearInt = parseInt(year);
            if (yearInt >= 0 && yearInt <= 29) {
                fullYear = `20${year}`;
            } else {
                fullYear = `19${year}`;
            }

            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 
                          'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const monthInt = parseInt(month);
            
            // Validate month
            if (monthInt < 1 || monthInt > 12) {
                return folderName; // Return raw if invalid
            }
            
            const monthName = months[monthInt - 1];

            return `${day} ${monthName} ${fullYear} ${hour}:${minute}`;
        }

        // Get absolute URL for a file
        function getAbsoluteUrl(folderName, fileName) {
            const baseUrl = window.location.origin + window.location.pathname.replace(/\/[^\/]*$/, '');
            return `${baseUrl}/${folderName}/${fileName}`;
        }

        // Get absolute URL for job listing
        function getJobAbsoluteUrl(folderName, fileName) {
            const baseUrl = window.location.origin + window.location.pathname.replace(/resumes\/[^\/]*$/, '');
            return `${baseUrl}jobs/${folderName}/${fileName}`;
        }

        // Copy URL to clipboard
        function copyToClipboard(url, iconElement) {
            navigator.clipboard.writeText(url).then(() => {
                // Show copied tooltip
                iconElement.classList.add('show');
                setTimeout(() => {
                    iconElement.classList.remove('show');
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy:', err);
                alert('Failed to copy URL to clipboard');
            });
        }

        // Create a file link element with copy icon
        function createFileLink(folderName, fileName, label) {
            const fileItem = document.createElement('div');
            fileItem.className = 'file-item';

            const labelElement = document.createElement('div');
            labelElement.className = 'file-label';
            labelElement.textContent = label;
            fileItem.appendChild(labelElement);

            if (fileName) {
                const container = document.createElement('div');
                container.className = 'link-container';

                const link = document.createElement('a');
                link.href = `${folderName}/${fileName}`;
                link.className = 'file-link';
                link.textContent = fileName;
                link.target = '_blank';

                const copyIcon = document.createElement('span');
                copyIcon.className = 'copy-icon copied-tooltip';
                copyIcon.textContent = 'ðŸ“‹';
                copyIcon.title = 'Copy URL';
                copyIcon.onclick = (e) => {
                    e.preventDefault();
                    const url = getAbsoluteUrl(folderName, fileName);
                    copyToClipboard(url, copyIcon);
                };

                container.appendChild(link);
                container.appendChild(copyIcon);
                fileItem.appendChild(container);
            } else {
                const span = document.createElement('span');
                span.className = 'not-generated';
                span.textContent = 'Not Generated';
                fileItem.appendChild(span);
            }

            return fileItem;
        }

        // Generate job cards
        async function generateJobCards(jobsData) {
            const jobCardsContainer = document.getElementById('job-cards');
            jobCardsContainer.innerHTML = '';

            if (jobsData.length === 0) {
                jobCardsContainer.innerHTML = '<div class="loading">No job listings found</div>';
                return;
            }

            jobsData.forEach(jobData => {
                const folder = jobData.name;
                const files = jobData.files;

                const card = document.createElement('div');
                card.className = 'job-card';

                // Date
                const dateDiv = document.createElement('div');
                dateDiv.className = 'job-card-date';
                dateDiv.textContent = formatDate(folder);
                card.appendChild(dateDiv);

                // Link to job listing
                if (files.html) {
                    const link = document.createElement('a');
                    link.href = `../jobs/${folder}/${files.html}`;
                    link.className = 'job-card-link';
                    link.textContent = 'View Job Listing Details â†’';
                    link.target = '_blank';
                    card.appendChild(link);

                    // Embed iframe to show preview
                    const iframe = document.createElement('iframe');
                    iframe.src = `../jobs/${folder}/${files.html}`;
                    iframe.title = `Job listing from ${formatDate(folder)}`;
                    card.appendChild(iframe);
                }

                jobCardsContainer.appendChild(card);
            });
        }

        // Generate resume cards
        async function generateCards() {
            const cardsContainer = document.getElementById('archive-cards');
            cardsContainer.innerHTML = '<div class="loading">Loading...</div>';

            try {
                // Load folder data from JSON
                const data = await loadFolderData();
                const folders = data.resumes || [];
                const jobs = data.jobs || [];
                
                // Clear loading message
                cardsContainer.innerHTML = '';
                
                // Generate job cards
                generateJobCards(jobs);
                
                // Process each resume folder
                folders.forEach(folderData => {
                    const folder = folderData.name;
                    const files = folderData.files;
                    
                    const card = document.createElement('div');
                    card.className = 'archive-card';

                    // Card header with date and application info
                    const header = document.createElement('div');
                    header.className = 'card-header';

                    const dateDiv = document.createElement('div');
                    dateDiv.className = 'card-date';
                    dateDiv.textContent = formatDate(folder);
                    header.appendChild(dateDiv);

                    // Application information
                    const appInfo = document.createElement('div');
                    appInfo.className = 'application-info';

                    if (files.applicationData) {
                        const companyDiv = document.createElement('div');
                        companyDiv.className = 'company-name';
                        companyDiv.textContent = files.applicationData.Company || 'N/A';
                        appInfo.appendChild(companyDiv);

                        const jobTitleDiv = document.createElement('div');
                        jobTitleDiv.className = 'job-title';
                        jobTitleDiv.textContent = files.applicationData['Job Title'] || 'N/A';
                        appInfo.appendChild(jobTitleDiv);

                        if (files.applicationData['Job Listing URL']) {
                            const jobLink = document.createElement('a');
                            jobLink.href = files.applicationData['Job Listing URL'];
                            jobLink.className = 'job-link';
                            jobLink.target = '_blank';
                            jobLink.rel = 'noopener noreferrer';
                            jobLink.innerHTML = 'ðŸ”— View Job Listing';
                            appInfo.appendChild(jobLink);
                        }
                    } else {
                        const noData = document.createElement('div');
                        noData.className = 'no-application-data';
                        noData.textContent = 'No application details available';
                        appInfo.appendChild(noData);
                    }

                    header.appendChild(appInfo);
                    card.appendChild(header);

                    // Files grid
                    const filesGrid = document.createElement('div');
                    filesGrid.className = 'files-grid';

                    // HTML Resume
                    filesGrid.appendChild(createFileLink(folder, files.html, 'HTML Resume'));

                    // Docx Resume
                    filesGrid.appendChild(createFileLink(folder, files.resume, 'Docx Resume'));

                    // Cover Letter
                    filesGrid.appendChild(createFileLink(folder, files.coverLetter, 'Cover Letter'));

                    card.appendChild(filesGrid);
                    cardsContainer.appendChild(card);
                });
                
                if (folders.length === 0) {
                    cardsContainer.innerHTML = '<div class="loading">No date folders found</div>';
                }
            } catch (error) {
                console.error('Error generating cards:', error);
                cardsContainer.innerHTML = '<div class="loading" style="color: red;">Error loading data</div>';
            }
        }

        // Initialize cards on page load
        document.addEventListener('DOMContentLoaded', generateCards);
    </script>
</body>
</html>
